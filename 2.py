def update_metadata_save_rand_sample(fp , save_rand_sample = True) :
    """
    :param fp:
    :param save_rand_sample:
    :return:
    """
    cns = MetadataColumns()

    dirpth = Path(fp).parent
    metafp = dirpth / 'META.json'
    if not metafp.exists() :
        return None

    with open(metafp) as fi :
        meta = json.load(fi)

    df = read_data_according_to_type(fp)

    if cns.startendcol in meta.keys() :
        if meta[cns.startendcol] is not None :
            meta[cns.start] = df[meta[cns.startendcol]].min()
            meta[cns.end] = df[meta[cns.startendcol]].max()

    meta[cns.numrow] = len(df)
    meta[cns.numcol] = len(df.columns)
    meta[cns.colnames] = list(df.columns)

    with open(metafp , 'w' , encoding = 'utf-8') as fi :
        json.dump(meta , fi , ensure_ascii = False)
        print("Meta updated.")

    if save_rand_sample and len(df) > 1000 :
        _df = df.sample(n = 1000)
        _fp = Path(fp).with_stem('Sample').with_suffix('.xlsx')
        sxl(_df , _fp)
        print('random sample saved.')
